{
    order rate_limit before basicauth
}

www.wordnet.dk {
    redir https://wordnet.dk{uri}
}

wordnet.dk, localhost {
    redir / /dannet

    # a reasonably generous OUTER rate limit based solely on the IP address
    # additional rate limiting should occur WITHIN the web service itself
    rate_limit {remote.ip} 1200r/m

    encode gzip

    # MCP Registry HTTP verification
    handle /.well-known/mcp-registry-auth {
        respond "v=MCPv1; k=ed25519; p=VRttGAV7g424WtABMMHdpZrCuhDR/zQrS+Ni+CGiBKs="
    }

    # Route MCP requests to the MCP server
    handle /mcp* {
        reverse_proxy mcp:8000
    }

    # Everything else goes to the DanNet web service
    handle {
        reverse_proxy dannet:3456
    }
}
